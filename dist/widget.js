(()=>{"use strict";class t{constructor(t){this.album=t?.album?.["#text"],this.artist=t?.artist?.["#text"],this.nowPlaying=!!t?.["@attr"]?.nowplaying,this.title=t?.name;const e=t?.image;Array.isArray(e)?(this.albumArtSmall=e.find((t=>"small"===t?.size))?.["#text"],this.albumArtMedium=e.find((t=>"medium"===t?.size))?.["#text"],this.albumArtLarge=e.find((t=>"large"===t?.size))?.["#text"],this.albumArtExtraLarge=e.find((t=>"extralarge"===t?.size))?.["#text"]):(this.albumArtSmall=null,this.albumArtMedium=null,this.albumArtLarge=null,this.albumArtExtraLarge=null)}equals(t){return!!t&&this.album===t.album&&this.artist===t.artist&&this.title===t.title}}class e{constructor(t){if(this.apiKey=t,!this.apiKey)throw new Error("LastFmService::Constructor - Parameter 'apiKey' was not provided. An API key must be provided.")}async getMostRecentTrack(t){return this.getRecentTracks(t,1)}async getRecentTracks(e,r){if(!e)throw new Error("LastFmService::getRecentTracks - Parameter 'user' cannot be null or undefined.");if(r<1||r>200)throw new Error("LastFmService::getRecentTracks - Parameter 'limit' must be a positive integer with a maximum value of 200.");const a=`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${e}&limit=${r}&api_key=${this.apiKey}&format=json`;return fetch(a,{mode:"cors",headers:{"Content-Type":"application/json",SameSite:"Strict"}}).then((t=>t.json())).then((e=>{const r=e?.recenttracks?.track?.[0];return new t(r)}))}}class r{constructor(t,r){if(this.user=r,this.apiPollingInterval=2e4,this.lastFmService=new e(t),!this.user)throw new Error("NowPlayingWidget::Constructor - Parameter 'user' was not provided. A user must be provided.")}checkNowPlaying(){this.lastFmService.getMostRecentTrack(this.user).then((t=>{t.nowPlaying&&!t.equals(this.currentTrack)&&(this.currentTrack=t,this.updateNowPlayingTrack(this.currentTrack))})).finally((()=>{setTimeout((()=>this.checkNowPlaying()),this.apiPollingInterval)}))}start(){this.checkNowPlaying()}updateNowPlayingTrack(t){this.updateNowPlayingTrackAlbum(t.album),this.updateNowPlayingTrackArt(t.albumArtExtraLarge),this.updateNowPlayingTrackArtist(t.artist),this.updateNowPlayingTrackTitle(t.title)}updateNowPlayingTrackArt(t){document.querySelector("img.track-art").setAttribute("src",t)}updateNowPlayingTrackTitle(t){document.querySelector(".track-title").innerText=t}updateNowPlayingTrackArtist(t){document.querySelector(".track-artist").innerText=t}updateNowPlayingTrackAlbum(t){document.querySelector(".track-album").innerText=t}}let a;window.addEventListener("onWidgetLoad",(function(t){const e=t.detail.fieldData,i=e.lastFmApiKey,s=e.lastFmUsername;a=new r(i,s),a.start()}))})();